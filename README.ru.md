# Crypto Wallets Service

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–¥–ø–∏—Å–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ù–∞–ø–∏—Å–∞–Ω –Ω–∞ Rust —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Axum, PostgreSQL –∏ HashiCorp Vault.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **–ú—É–ª—å—Ç–∏-—á–µ–π–Ω**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Ethereum (ETH), Tron (TRX), Solana (SOL), TON.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
    *   –ú–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–∑—ã (seed) —à–∏—Ñ—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ **Transit Engine** –≤ HashiCorp Vault.
    *   –ö–ª—é—á–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î.
*   **HD Wallets**: –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (BIP-32/39/44).
*   **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (Observability)**:
    *   –ú–µ—Ç—Ä–∏–∫–∏ Prometheus (`/metrics`).
    *   –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `X-Request-ID`.
*   **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
    *   Swagger UI (`/swagger-ui`).
    *   –ö–æ–ª–ª–µ–∫—Ü–∏—è Postman –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ.
*   **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**:
    *   Rate Limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤).
    *   –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π (Audit Logs).
    *   –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Testcontainers).

## üõ† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

*   **API Layer**: Rust (Axum) - –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP/gRPC.
*   **Storage**: PostgreSQL - –•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –ø—É—Ç–µ–π –¥–µ—Ä–∏–≤–∞—Ü–∏–∏.
*   **Key Management**: HashiCorp Vault - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –Ω–∞ –ª–µ—Ç—É.

## üèÅ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

*   Rust 1.80+
*   Docker & Docker Compose

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1.  **–ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**:
    ```bash
    make up
    ```
    –ü–æ–¥–Ω–∏–º–µ—Ç Postgres (5432) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Vault (8200).
    *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: Vault –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `docker/vault-init.sh`.*

2.  **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞**:
    ```bash
    make run
    ```
    –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å–∞–º `0.0.0.0:3000` (HTTP) –∏ `0.0.0.0:3001` (gRPC).

### –ö–æ–º–∞–Ω–¥—ã Makefile

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| `make up` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (Postgres, Vault) |
| `make down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É |
| `make test-int` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| `make lint` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä clippy |
| `make fmt` | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ |

## üìñ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

*   **Swagger UI**: –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/swagger-ui` –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
*   **gRPC Proto**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `proto/wallet.proto`.
*   **Postman**: –ö–æ–ª–ª–µ–∫—Ü–∏—è `postman_collection.json` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ `config/default.toml` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `SERVER.HOST` | `127.0.0.1` | –ê–¥—Ä–µ—Å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è |
| `SERVER.PORT` | `3000` | –ü–æ—Ä—Ç |
| `DATABASE.URL` | `postgres://...` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î |
| `VAULT.URL` | `http://127.0.0.1:8200` | –ê–¥—Ä–µ—Å Vault |
| `VAULT.TOKEN` | `root` | –¢–æ–∫–µ–Ω Vault |

## üìñ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

*   **Swagger UI**: –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/swagger-ui` –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
*   **Health Check**: `GET /api/v1/health`
*   **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞**: `POST /api/v1/wallets`
*   **–ü–æ–¥–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: `POST /api/v1/wallets/{id}/sign`

## üë®‚Äçüíª –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Ç–∏

1.  **Enum**: –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ç—å –≤ `src/core/mod.rs` (`enum Network`).
2.  **–î–µ—Ä–∏–≤–∞—Ü–∏—è**: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø—É—Ç—å (derivation path) –≤ `src/core/wallet.rs`.
3.  **–§–æ—Ä–º–∞—Ç –∞–¥—Ä–µ—Å–∞**: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –≤ `src/core/address.rs`.
4.  **–ü–æ–¥–ø–∏—Å—å**: –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –ø–æ–¥–ø–∏—Å–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—é `sign_tx`.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

*   **Unit —Ç–µ—Å—Ç—ã**:
    ```bash
    cargo test --lib
    ```
*   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**:
    –ò—Å–ø–æ–ª—å–∑—É—é—Ç Docker –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
    ```bash
    cargo test --test integration_test
    ```

## üì¶ –î–µ–ø–ª–æ–π

### GitLab CI/CD

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª `.gitlab-ci.yml` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∏–ª—è (lint), –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏ —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–∞.

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ GitLab:**
- `CI_REGISTRY_USER`: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ GitLab Container Registry (–æ–±—ã—á–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è GitLab –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
- `CI_REGISTRY_PASSWORD`: –ü–∞—Ä–æ–ª—å –∏–ª–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ Registry (–æ–±—ã—á–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è GitLab –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
- `CI_REGISTRY`: –ê–¥—Ä–µ—Å —Ä–µ–µ—Å—Ç—Ä–∞ –æ–±—Ä–∞–∑–æ–≤ (–æ–±—ã—á–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è GitLab –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ —Ä–∞–Ω–Ω–µ—Ä–∞–º:**
–ü–∞–π–ø–ª–∞–π–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–Ω–Ω–µ—Ä–æ–≤ —Å —Ç–µ–≥–æ–º `docker`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–∏ GitLab —Ä–∞–Ω–Ω–µ—Ä—ã –∏–º–µ—é—Ç —ç—Ç–æ—Ç —Ç–µ–≥.

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ (push) –æ–±—Ä–∞–∑–æ–≤ –≤ —Ä–µ–µ—Å—Ç—Ä, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ `docker login` –∏ `docker push` –≤ —Ñ–∞–π–ª–µ `.gitlab-ci.yml`.

### Docker

–°–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–±—Ä–∞–∑–∞:
```bash
docker build -f docker/prod.Dockerfile -t crypto-wallets-service:latest .
```

–ó–∞–ø—É—Å–∫:
```bash
docker run -p 3000:3000 -e DATABASE_URL=... -e VAULT_URL=... crypto-wallets-service:latest
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

*   –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS.
*   –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ `VAULT_TOKEN`.
*   –ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ç—É—Ä —Å–µ—Ç–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î –∏ Vault.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
