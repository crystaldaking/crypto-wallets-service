# Crypto Wallets Service

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–¥–ø–∏—Å–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ù–∞–ø–∏—Å–∞–Ω –Ω–∞ Rust —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Axum, PostgreSQL –∏ HashiCorp Vault.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **–ú—É–ª—å—Ç–∏-—á–µ–π–Ω**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Ethereum (ETH), Tron (TRX), Solana (SOL), TON.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
    *   –ú–Ω–µ–º–æ–Ω–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–∑—ã (seed) —à–∏—Ñ—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ **Transit Engine** –≤ HashiCorp Vault.
    *   –ö–ª—é—á–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î.
    *   –°—Ä–∞–≤–Ω–µ–Ω–∏–µ API –∫–ª—é—á–∞ –≤ constant-time (–∑–∞—â–∏—Ç–∞ –æ—Ç timing-–∞—Ç–∞–∫).
    *   –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ API –∫–ª—é—á—É (—Å —è–≤–Ω—ã–º opt-out –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).
    *   –°–µ–∫—Ä–µ—Ç—ã —Å–∫—Ä—ã—Ç—ã –≤ –ª–æ–≥–∞—Ö (`[REDACTED]`).
*   **HD Wallets**: –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (BIP-32/39/44).
*   **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (Observability)**:
    *   –ú–µ—Ç—Ä–∏–∫–∏ Prometheus (`/metrics`).
    *   –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `X-Request-ID`.
    *   –ê—É–¥–∏—Ç –≤—Å–µ—Ö —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (Audit Logs).
*   **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
    *   Swagger UI (`/swagger-ui`).
    *   –ö–æ–ª–ª–µ–∫—Ü–∏—è Postman –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ.
*   **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**:
    *   Rate Limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤).
    *   –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
    *   –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Testcontainers).
    *   –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –ë–î —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ä–∞–∑–º–µ—Ä–æ–º.

## üõ† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

*   **API Layer**: Rust (Axum) - –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP/gRPC –∑–∞–ø—Ä–æ—Å–æ–≤.
*   **Storage**: PostgreSQL - –•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –ø—É—Ç–µ–π –¥–µ—Ä–∏–≤–∞—Ü–∏–∏.
*   **Key Management**: HashiCorp Vault - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –Ω–∞ –ª–µ—Ç—É.

## üèÅ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

*   Rust 1.80+
*   Docker & Docker Compose
*   –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä Protocol Buffers (`protoc`):
    ```bash
    # macOS
    brew install protobuf
    
    # Debian/Ubuntu
    apt install protobuf-compiler
    ```

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1.  **–ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**:
    ```bash
    make up
    ```
    –ü–æ–¥–Ω–∏–º–µ—Ç Postgres (5432) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Vault (8200).
    *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: Vault –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `docker/vault-init.sh`.*

2.  **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ API –∫–ª—é—á–∞** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è production):
    ```bash
    export APP__SERVER__API_KEY=–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á
    ```
    –ò–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ù–ï –¥–ª—è production):
    ```bash
    export ALLOW_UNAUTHENTICATED=true
    ```

3.  **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞**:
    ```bash
    make run
    ```
    –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å–∞–º `0.0.0.0:3000` (HTTP) –∏ `0.0.0.0:3001` (gRPC).

### –ö–æ–º–∞–Ω–¥—ã Makefile

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| `make up` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (Postgres, Vault) |
| `make down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É |
| `make test-int` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| `make lint` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä clippy |
| `make fmt` | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ |

## üìñ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

*   **Swagger UI**: –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/swagger-ui` –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
*   **gRPC Proto**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `proto/wallet.proto`.
*   **Postman**: –ö–æ–ª–ª–µ–∫—Ü–∏—è `postman_collection.json` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø—Ä–µ—Ñ–∏–∫—Å: `APP__`, —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: `__`).

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `APP__SERVER__PORT` | `3000` | HTTP –ø–æ—Ä—Ç |
| `APP__SERVER__GRPC_PORT` | `3001` | gRPC –ø–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é port + 1) |
| `APP__SERVER__API_KEY` | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* | API –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `APP__DATABASE__URL` | ‚Äî | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL |
| `APP__DATABASE__POOL_SIZE` | `20` | –†–∞–∑–º–µ—Ä –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –ë–î |
| `APP__VAULT__ADDRESS` | `http://127.0.0.1:8200` | –ê–¥—Ä–µ—Å Vault |
| `APP__VAULT__TOKEN` | `root` | –¢–æ–∫–µ–Ω Vault |
| `APP__VAULT__KEY_ID` | `wallet-master-key` | –ò–º—è –∫–ª—é—á–∞ Transit encryption |

### –ü—Ä–∏–º–µ—Ä

```bash
export APP__SERVER__PORT=3000
export APP__SERVER__API_KEY=super-secret-key
export APP__DATABASE__URL="postgres://user:pass@localhost:5432/wallets"
export APP__DATABASE__POOL_SIZE=50
export APP__VAULT__ADDRESS="http://127.0.0.1:8200"
export APP__VAULT__TOKEN="root"
```

## üìù API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

*   **Health Check**: `GET /api/v1/health`
*   **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞**: `POST /api/v1/wallets`
*   **–°–ø–∏—Å–æ–∫ –∫–æ—à–µ–ª—å–∫–æ–≤** (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π): `GET /api/v1/wallets?page=1&per_page=20`
*   **–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞**: `GET /api/v1/wallets/{id}/address/{network}?index=0`
*   **–ü–æ–¥–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: `POST /api/v1/wallets/{id}/sign`

## üë®‚Äçüíª –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Ç–∏

1.  **Enum**: –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ç—å –≤ `src/core/mod.rs` (`enum Network`).
2.  **–î–µ—Ä–∏–≤–∞—Ü–∏—è**: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø—É—Ç—å (derivation path) –≤ `Network::derivation_path()`.
3.  **–§–æ—Ä–º–∞—Ç –∞–¥—Ä–µ—Å–∞**: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –≤ `WalletManager::derive_address_from_mnemonic()`.
4.  **–ü–æ–¥–ø–∏—Å—å**: –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –ø–æ–¥–ø–∏—Å–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—é `WalletManager::sign_tx()`.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

*   **Unit —Ç–µ—Å—Ç—ã**:
    ```bash
    cargo test --lib
    ```
*   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**:
    –ò—Å–ø–æ–ª—å–∑—É—é—Ç Docker –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
    ```bash
    cargo test --test integration_test
    ```

## üì¶ –î–µ–ø–ª–æ–π

### GitLab CI/CD

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª `.gitlab-ci.yml` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∏–ª—è (lint), –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏ —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–∞.

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ GitLab:**
- `CI_REGISTRY_USER`: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ GitLab Container Registry
- `CI_REGISTRY_PASSWORD`: –ü–∞—Ä–æ–ª—å –∏–ª–∏ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ Registry
- `CI_REGISTRY`: –ê–¥—Ä–µ—Å —Ä–µ–µ—Å—Ç—Ä–∞ –æ–±—Ä–∞–∑–æ–≤

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ —Ä–∞–Ω–Ω–µ—Ä–∞–º:**
–ü–∞–π–ø–ª–∞–π–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–Ω–Ω–µ—Ä–æ–≤ —Å —Ç–µ–≥–æ–º `docker`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–∏ GitLab —Ä–∞–Ω–Ω–µ—Ä—ã –∏–º–µ—é—Ç —ç—Ç–æ—Ç —Ç–µ–≥.

### Docker

–°–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–±—Ä–∞–∑–∞:
```bash
docker build -f docker/prod.Dockerfile -t crypto-wallets-service:latest .
```

**–í–∞–∂–Ω–æ**: –ü—Ä–æ–¥–∞–∫—à–Ω –æ–±—Ä–∞–∑ –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç development –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. –í—ã –î–û–õ–ñ–ù–´ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
docker run -p 3000:3000 \
  -e APP__SERVER__API_KEY=–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á \
  -e APP__DATABASE__URL=postgres://... \
  -e APP__VAULT__ADDRESS=http://vault:8200 \
  -e APP__VAULT__TOKEN=... \
  crypto-wallets-service:latest
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

*   **API –∫–ª—é—á –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** ‚Äî –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ `APP__SERVER__API_KEY`, –µ—Å–ª–∏ —è–≤–Ω–æ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `ALLOW_UNAUTHENTICATED=true` (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).
*   –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Vault –≤ sealed —Ä–µ–∂–∏–º–µ.
*   –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ `VAULT_TOKEN`.
*   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ TLS –¥–ª—è –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ë–î, Vault, HTTP) –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.
*   –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Å–∫—Ä—ã—Ç—ã –≤ –ª–æ–≥–∞—Ö (`[REDACTED]`).

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

**–í–µ—Ä—Å–∏—è 1.0.5** ‚Äî –°–º. [CHANGELOG.md](CHANGELOG.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π –æ —Ä–µ–ª–∏–∑–µ.
