# Crypto Wallets Service

Ð’Ñ‹ÑÐ¾ÐºÐ¾Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¸ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸Ñ Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸, Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¸ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ ÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²Ð°Ð»ÑŽÑ‚Ð½Ñ‹Ñ… Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹. ÐÐ°Ð¿Ð¸ÑÐ°Ð½ Ð½Ð° Rust Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Axum, PostgreSQL Ð¸ HashiCorp Vault.

## ðŸš€ Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

*   **ÐœÑƒÐ»ÑŒÑ‚Ð¸-Ñ‡ÐµÐ¹Ð½**: Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ethereum (ETH), Tron (TRX), Solana (SOL), TON.
*   **Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ**:
    *   ÐœÐ½ÐµÐ¼Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ„Ñ€Ð°Ð·Ñ‹ (seed) ÑˆÐ¸Ñ„Ñ€ÑƒÑŽÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· **Transit Engine** Ð² HashiCorp Vault.
    *   ÐšÐ»ÑŽÑ‡Ð¸ Ð² Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾Ð¼ Ð²Ð¸Ð´Ðµ Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð² Ð‘Ð”.
    *   Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ API ÐºÐ»ÑŽÑ‡Ð° Ð² constant-time (Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ timing-Ð°Ñ‚Ð°Ðº).
    *   ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¿Ð¾ API ÐºÐ»ÑŽÑ‡Ñƒ (Ñ ÑÐ²Ð½Ñ‹Ð¼ opt-out Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸).
    *   Ð¡ÐµÐºÑ€ÐµÑ‚Ñ‹ ÑÐºÑ€Ñ‹Ñ‚Ñ‹ Ð² Ð»Ð¾Ð³Ð°Ñ… (`[REDACTED]`).
*   **HD Wallets**: Ð˜ÐµÑ€Ð°Ñ€Ñ…Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð´ÐµÑ‚ÐµÑ€Ð¼Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ (BIP-32/39/44).
*   **ÐÐ°Ð±Ð»ÑŽÐ´Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ (Observability)**:
    *   ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Prometheus (`/metrics`).
    *   Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ `X-Request-ID`.
    *   ÐÑƒÐ´Ð¸Ñ‚ Ð²ÑÐµÑ… Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ (Audit Logs).
*   **Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ**:
    *   Swagger UI (`/swagger-ui`).
    *   ÐšÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ñ Postman Ð² ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ðµ.
*   **ÐÐ°Ð´Ñ‘Ð¶Ð½Ð¾ÑÑ‚ÑŒ**:
    *   Rate Limiting (Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²).
    *   ÐŸÐ°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð½Ð°Ð±Ð¾Ñ€Ð¾Ð² Ð´Ð°Ð½Ð½Ñ‹Ñ….
    *   ÐŸÐ¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹ (Testcontainers).
    *   ÐŸÑƒÐ» ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹ Ñ Ð‘Ð” Ñ Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ð¼ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð¼.

## ðŸ›  ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

*   **API Layer**: Rust (Axum) - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° HTTP/gRPC Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð².
*   **Storage**: PostgreSQL - Ð¥Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ð¿ÑƒÑ‚ÐµÐ¹ Ð´ÐµÑ€Ð¸Ð²Ð°Ñ†Ð¸Ð¸.
*   **Key Management**: HashiCorp Vault - Ð¨Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ñ€Ð°ÑÑˆÐ¸Ñ„Ñ€Ð¾Ð²ÐºÐ° Ð½Ð° Ð»ÐµÑ‚Ñƒ.

## ðŸ ÐÐ°Ñ‡Ð°Ð»Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹

### Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

*   Rust 1.80+
*   Docker & Docker Compose
*   ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ‚Ð¾Ñ€ Protocol Buffers (`protoc`):
    ```bash
    # macOS
    brew install protobuf
    
    # Debian/Ubuntu
    apt install protobuf-compiler
    ```

### Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº

1.  **Ð—Ð°Ð¿ÑƒÑÐº Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹**:
    ```bash
    make up
    ```
    ÐŸÐ¾Ð´Ð½Ð¸Ð¼ÐµÑ‚ Postgres (5432) Ð¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Vault (8200).
    *ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Vault Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ñ‡ÐµÑ€ÐµÐ· `docker/vault-init.sh`.*

2.  **Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° API ÐºÐ»ÑŽÑ‡Ð°** (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ production):
    ```bash
    export APP__SERVER__API_KEY=Ð²Ð°Ñˆ-ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹-ÐºÐ»ÑŽÑ‡
    ```
    Ð˜Ð»Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ (ÐÐ• Ð´Ð»Ñ production):
    ```bash
    export ALLOW_UNAUTHENTICATED=true
    ```

3.  **Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ°**:
    ```bash
    make run
    ```
    Ð¡ÐµÑ€Ð²Ð¸Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÐ°Ð¼ `0.0.0.0:3000` (HTTP) Ð¸ `0.0.0.0:3001` (gRPC).

### ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Makefile

| ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
| :--- | :--- |
| `make up` | Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ (Postgres, Vault) |
| `make down` | ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ |
| `make test-int` | Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹ |
| `make lint` | Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð»Ð¸Ð½Ñ‚ÐµÑ€ clippy |
| `make fmt` | Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð´Ð° |

## ðŸ“– API Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

*   **Swagger UI**: ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ `http://localhost:3000/swagger-ui` Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ.
*   **gRPC Proto**: ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð² `proto/wallet.proto`.
*   **Postman**: ÐšÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ñ `postman_collection.json` Ð´Ð»Ñ Ñ€ÑƒÑ‡Ð½Ð¾Ð³Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ.

## âš™ï¸ ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ

ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ (Ð¿Ñ€ÐµÑ„Ð¸ÐºÑ: `APP__`, Ñ€Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ: `__`).

| ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ | ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
| :--- | :--- | :--- |
| `APP__SERVER__PORT` | `3000` | HTTP Ð¿Ð¾Ñ€Ñ‚ |
| `APP__SERVER__GRPC_PORT` | `3001` | gRPC Ð¿Ð¾Ñ€Ñ‚ (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ port + 1) |
| `APP__SERVER__API_KEY` | *Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾* | API ÐºÐ»ÑŽÑ‡ Ð´Ð»Ñ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ |
| `APP__DATABASE__URL` | â€” | Ð¡Ñ‚Ñ€Ð¾ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº PostgreSQL |
| `APP__DATABASE__POOL_SIZE` | `20` | Ð Ð°Ð·Ð¼ÐµÑ€ Ð¿ÑƒÐ»Ð° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹ Ñ Ð‘Ð” |
| `APP__VAULT__ADDRESS` | `http://127.0.0.1:8200` | ÐÐ´Ñ€ÐµÑ Vault |
| `APP__VAULT__TOKEN` | `root` | Ð¢Ð¾ÐºÐµÐ½ Vault |
| `APP__VAULT__KEY_ID` | `wallet-master-key` | Ð˜Ð¼Ñ ÐºÐ»ÑŽÑ‡Ð° Transit encryption |

### ÐŸÑ€Ð¸Ð¼ÐµÑ€

```bash
export APP__SERVER__PORT=3000
export APP__SERVER__API_KEY=super-secret-key
export APP__DATABASE__URL="postgres://user:pass@localhost:5432/wallets"
export APP__DATABASE__POOL_SIZE=50
export APP__VAULT__ADDRESS="http://127.0.0.1:8200"
export APP__VAULT__TOKEN="root"
```

## ðŸ“ API Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹

*   **Health Check**: `GET /api/v1/health`
*   **Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ°**: `POST /api/v1/wallets`
*   **Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ¾Ð²** (Ñ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸ÐµÐ¹): `GET /api/v1/wallets?page=1&per_page=20`
*   **ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð°Ð´Ñ€ÐµÑÐ°**: `GET /api/v1/wallets/{id}/address/{network}?index=0`
*   **ÐŸÐ¾Ð´Ð¿Ð¸ÑÑŒ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸**: `POST /api/v1/wallets/{id}/sign`

## ðŸ—„ Ð¡Ñ…ÐµÐ¼Ð° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹

#### `master_wallets`
Ð¥Ñ€Ð°Ð½Ð¸Ñ‚ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ¾Ð² Ñ Ð·Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð¼Ð½ÐµÐ¼Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼Ð¸ Ñ„Ñ€Ð°Ð·Ð°Ð¼Ð¸.

| ÐŸÐ¾Ð»Ðµ | Ð¢Ð¸Ð¿ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|-----|----------|
| `id` | UUID (PK) | Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ° |
| `label` | TEXT | Ð§ÐµÐ»Ð¾Ð²ÐµÐºÐ¾Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ° |
| `encrypted_phrase` | TEXT | ÐœÐ½ÐµÐ¼Ð¾Ð½Ð¸ÐºÐ°, Ð·Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ñ‡ÐµÑ€ÐµÐ· Vault Transit |
| `created_at` | TIMESTAMPTZ | Ð’Ñ€ÐµÐ¼Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ |

#### `derived_addresses`
ÐšÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð½Ñ‹Ðµ Ð°Ð´Ñ€ÐµÑÐ° Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÐµÑ‚Ð¸ Ð¸ Ð¸Ð½Ð´ÐµÐºÑÐ°.

| ÐŸÐ¾Ð»Ðµ | Ð¢Ð¸Ð¿ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|-----|----------|
| `id` | UUID (PK) | Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð°Ð´Ñ€ÐµÑÐ° |
| `wallet_id` | UUID (FK) | Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° master_wallets |
| `network` | TEXT | Ð‘Ð»Ð¾ÐºÑ‡ÐµÐ¹Ð½-ÑÐµÑ‚ÑŒ (eth, tron, sol, ton) |
| `address_index` | INTEGER | Ð˜Ð½Ð´ÐµÐºÑ Ð´ÐµÑ€Ð¸Ð²Ð°Ñ†Ð¸Ð¸ HD-ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ° |
| `address` | TEXT | ÐŸÑ€Ð¾Ð¸Ð·Ð²ÐµÐ´Ñ‘Ð½Ð½Ñ‹Ð¹ Ð±Ð»Ð¾ÐºÑ‡ÐµÐ¹Ð½-Ð°Ð´Ñ€ÐµÑ |
| `created_at` | TIMESTAMPTZ | Ð’Ñ€ÐµÐ¼Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ |

**Ð˜Ð½Ð´ÐµÐºÑÑ‹:**
- `idx_derived_addresses_wallet_id` â€” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÑƒ
- `idx_derived_addresses_address` â€” Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð°Ð´Ñ€ÐµÑÐ° Ð² ÐºÐ¾ÑˆÐµÐ»Ñ‘Ðº
- `idx_derived_addresses_wallet_network_index` â€” Ð¡Ð¾ÑÑ‚Ð°Ð²Ð½Ð¾Ð¹ Ð´Ð»Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð´ÐµÑ€Ð¸Ð²Ð°Ñ†Ð¸Ð¸

#### `audit_logs`
Ð–ÑƒÑ€Ð½Ð°Ð» Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ Ð²ÑÐµÑ… Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹.

| ÐŸÐ¾Ð»Ðµ | Ð¢Ð¸Ð¿ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|-----|----------|
| `id` | UUID (PK) | Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð¿Ð¸ÑÐ¸ |
| `action` | VARCHAR(50) | Ð¢Ð¸Ð¿ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ (create_wallet, sign_transaction) |
| `wallet_id` | UUID (FK, nullable) | Ð—Ð°Ñ‚Ñ€Ð¾Ð½ÑƒÑ‚Ñ‹Ð¹ ÐºÐ¾ÑˆÐµÐ»Ñ‘Ðº |
| `status` | VARCHAR(20) | success / failed |
| `ip_address` | VARCHAR(45) | IP-Ð°Ð´Ñ€ÐµÑ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° |
| `details` | JSONB | Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ (Ð¾ÑˆÐ¸Ð±ÐºÐ¸, ÑÐµÑ‚ÑŒ Ð¸ Ñ‚.Ð´.) |
| `created_at` | TIMESTAMPTZ | Ð’Ñ€ÐµÐ¼Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ |

**Ð˜Ð½Ð´ÐµÐºÑÑ‹:**
- `idx_audit_logs_wallet_id` â€” Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ Ð¿Ð¾ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÑƒ
- `idx_audit_logs_created_at` â€” Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¼Ñƒ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ñƒ

### Ð”Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð° ÑÐ²ÑÐ·ÐµÐ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   master_wallets    â”‚       â”‚  derived_addresses   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK id               â”‚â”€â”€â”    â”‚ PK id                â”‚
â”‚    label            â”‚  â”‚    â”‚ FK wallet_id         â”‚â”€â”€â”
â”‚    encrypted_phrase â”‚  â””â”€â”€â”€>â”‚    network           â”‚  â”‚
â”‚    created_at       â”‚       â”‚    address_index     â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    address           â”‚  â”‚
         â”‚                    â”‚    created_at        â”‚  â”‚
         â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                                              â”‚
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
         â””â”€â”€â”€>â”‚     audit_logs       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ PK id                â”‚
              â”‚    action            â”‚
              â”‚ FK wallet_id (nullable)
              â”‚    status            â”‚
              â”‚    ip_address        â”‚
              â”‚    details (JSONB)   â”‚
              â”‚    created_at        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ‘¨â€ðŸ’» Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°

### Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ ÑÐµÑ‚Ð¸

1.  **Enum**: Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÐµÑ‚ÑŒ Ð² `src/core/mod.rs` (`enum Network`).
2.  **Ð”ÐµÑ€Ð¸Ð²Ð°Ñ†Ð¸Ñ**: Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐ¹Ñ‚Ðµ Ð¿ÑƒÑ‚ÑŒ (derivation path) Ð² `Network::derivation_path()`.
3.  **Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð°Ð´Ñ€ÐµÑÐ°**: Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð°Ð´Ñ€ÐµÑÐ° Ð² `WalletManager::derive_address_from_mnemonic()`.
4.  **ÐŸÐ¾Ð´Ð¿Ð¸ÑÑŒ**: Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ Ð² Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ `WalletManager::sign_tx()`.

### Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

*   **Unit Ñ‚ÐµÑÑ‚Ñ‹**:
    ```bash
    cargo test --lib
    ```
*   **Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹**:
    Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ Docker Ð´Ð»Ñ Ð¿Ð¾Ð´Ð½ÑÑ‚Ð¸Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ.
    ```bash
    cargo test --test integration_test
    ```

## ðŸ“¦ Ð”ÐµÐ¿Ð»Ð¾Ð¹

### GitLab CI/CD

ÐŸÑ€Ð¾ÐµÐºÑ‚ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ñ„Ð°Ð¹Ð» `.gitlab-ci.yml` Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÑ‚Ð¸Ð»Ñ (lint), Ð·Ð°Ð¿ÑƒÑÐºÐ° Ñ‚ÐµÑÑ‚Ð¾Ð² Ð¸ ÑÐ±Ð¾Ñ€ÐºÐ¸ Docker-Ð¾Ð±Ñ€Ð°Ð·Ð°.

**ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ Ð² GitLab:**
- `CI_REGISTRY_USER`: Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº GitLab Container Registry
- `CI_REGISTRY_PASSWORD`: ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð¸Ð»Ð¸ Ñ‚Ð¾ÐºÐµÐ½ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Registry
- `CI_REGISTRY`: ÐÐ´Ñ€ÐµÑ Ñ€ÐµÐµÑÑ‚Ñ€Ð° Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²

**ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ Ð¿Ð¾ Ñ€Ð°Ð½Ð½ÐµÑ€Ð°Ð¼:**
ÐŸÐ°Ð¹Ð¿Ð»Ð°Ð¹Ð½ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð½Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð½Ð½ÐµÑ€Ð¾Ð² Ñ Ñ‚ÐµÐ³Ð¾Ð¼ `docker`. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð²Ð°ÑˆÐ¸ GitLab Ñ€Ð°Ð½Ð½ÐµÑ€Ñ‹ Ð¸Ð¼ÐµÑŽÑ‚ ÑÑ‚Ð¾Ñ‚ Ñ‚ÐµÐ³.

### Docker

Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐ½ Ð¾Ð±Ñ€Ð°Ð·Ð°:
```bash
docker build -f docker/prod.Dockerfile -t crypto-wallets-service:latest .
```

**Ð’Ð°Ð¶Ð½Ð¾**: ÐŸÑ€Ð¾Ð´Ð°ÐºÑˆÐ½ Ð¾Ð±Ñ€Ð°Ð· ÐÐ• ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ development ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ. Ð’Ñ‹ Ð”ÐžÐ›Ð–ÐÐ« Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð²ÑÑŽ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ñ‡ÐµÑ€ÐµÐ· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ:

```bash
docker run -p 3000:3000 \
  -e APP__SERVER__API_KEY=Ð²Ð°Ñˆ-ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹-ÐºÐ»ÑŽÑ‡ \
  -e APP__DATABASE__URL=postgres://... \
  -e APP__VAULT__ADDRESS=http://vault:8200 \
  -e APP__VAULT__TOKEN=... \
  crypto-wallets-service:latest
```

## ðŸ”’ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

*   **API ÐºÐ»ÑŽÑ‡ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½** â€” Ð¡ÐµÑ€Ð²Ð¸Ñ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑÑ Ð±ÐµÐ· `APP__SERVER__API_KEY`, ÐµÑÐ»Ð¸ ÑÐ²Ð½Ð¾ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ `ALLOW_UNAUTHENTICATED=true` (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸).
*   Ð’ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Vault Ð² sealed Ñ€ÐµÐ¶Ð¸Ð¼Ðµ.
*   Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾ Ñ€Ð¾Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ `VAULT_TOKEN`.
*   Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ TLS Ð´Ð»Ñ Ð²ÑÐµÑ… ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹ (Ð‘Ð”, Vault, HTTP) Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ.
*   Ð’ÑÐµ ÑÐµÐºÑ€ÐµÑ‚Ñ‹ ÑÐºÑ€Ñ‹Ñ‚Ñ‹ Ð² Ð»Ð¾Ð³Ð°Ñ… (`[REDACTED]`).

## ðŸ“„ Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

MIT

---

**Ð’ÐµÑ€ÑÐ¸Ñ 1.0.5** â€” Ð¡Ð¼. [CHANGELOG.md](CHANGELOG.md) Ð´Ð»Ñ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð¾ Ñ€ÐµÐ»Ð¸Ð·Ðµ.
